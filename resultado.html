<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Planejamento de Produção – Dashboard</title>

<style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        background: #f5f5f5;
        padding: 20px;
        color: #333;
    }

    h1 { font-size: 24px; font-weight: 600; color: #2E7D32; margin-bottom: 5px; }
    .subtitle { color: #666; margin-bottom: 20px; }

    .dashboard {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 20px;
        margin-bottom: 20px;
    }

    .card {
        background: white;
        border: 1px solid #ddd;
        padding: 20px;
    }

    .card-header { font-size: 12px; color: #666; margin-bottom: 5px; }
    .card-value { font-size: 28px; font-weight: bold; color: #2E7D32; }
    .card-desc { font-size: 13px; margin-top: 5px; color: #777; }
    .card-value.azul { color: #1976D2; }

    .grid-2 {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin-bottom: 20px;
    }

    .produto-card, .maquina-card {
        background: white;
        padding: 20px;
        border: 1px solid #ddd;
    }

    .produto-card h3 { color: #1976D2; margin-bottom: 15px; }
    .maquina-card h3 { color: #2E7D32; margin-bottom: 10px; }

    .metric { margin-bottom: 12px; }
    .metric-label { font-size: 11px; color: #777; margin-bottom: 4px; }
    .metric-value { font-size: 20px; font-weight: bold; }

    .input-field {
        width: 100%; padding: 8px; font-size: 16px;
        border: 1px solid #ddd; border-radius: 4px;
    }

    .barra {
        background: #ddd;
        height: 25px;
        margin-top: 6px;
    }

    .barra-fill {
        height: 100%;
        text-align: right;
        padding-right: 8px;
        color: white;
        font-size: 11px;
        display: flex;
        align-items: center;
        justify-content: flex-end;
        font-weight: bold;
    }

    .input-cell {
        width: 60px; padding: 5px; text-align: center;
        border: 1px solid #ccc; border-radius: 4px;
    }

    table {
        margin: 0 auto;
        width: 350px;
        text-align: center;
        border-collapse: collapse;
        margin-top: 10px;
    }
    th, td { padding: 8px; }

</style>
</head>
<body>

<h1>Planejamento de Produção</h1>
<p class="subtitle">Dashboard de Otimização – Farmácia</p>

<div class="dashboard">

    <div class="card">
        <div class="card-header">Custo Total</div>
        <div class="card-value" id="custoTotal">R$ 0</div>
        <div class="card-desc">Custo de produção + penalidade</div>
    </div>

    <div class="card">
        <div class="card-header">Total de Lotes</div>
        <div class="card-value azul" id="totalLotes">0</div>
        <div class="card-desc" id="descLotes">—</div>
    </div>

    <div class="card">
        <div class="card-header">Penalidade</div>
        <div class="card-value" id="penalidadeTotal">R$ 0</div>
        <div class="card-desc" id="penalidadeDetalhes">Nenhuma penalidade</div>
    </div>

    <div class="card">
        <div class="card-header">Status da Solução</div>
        <div class="card-value" id="statusSolucao" style="font-size: 26px; color: #2E7D32;">✔ Viável</div>
        <div class="card-desc" id="statusDetalhes">Nenhuma restrição violada</div>
    </div>

</div>

<div class="grid-2">

    <div class="produto-card">
        <h3>P1</h3>

        <div class="metric">
            <div class="metric-label">Lotes a Produzir</div>
            <input type="number" id="lotesP1" class="input-field" value="60" onchange="calcular()">
        </div>

        <div class="metric">
            <div class="metric-label">Custo Total P1</div>
            <div class="metric-value" id="custoP1">R$ 0</div>
        </div>

        <div class="metric">
            <div class="metric-label">Custo por Lote</div>
            <input type="number" id="custoLoteP1" class="input-field" value="40" onchange="calcular()">
        </div>

        <div class="metric">
            <div class="metric-label">Demanda</div>
            <input type="number" id="demandaP1" class="input-field" value="60" onchange="calcular()">
        </div>

        <div class="metric">
            <div class="metric-label">Status</div>
            <div class="metric-value" id="statusP1">—</div>
        </div>
    </div>

    <div class="produto-card">
        <h3>P2</h3>

        <div class="metric">
            <div class="metric-label">Lotes a Produzir</div>
            <input type="number" id="lotesP2" class="input-field" value="40" onchange="calcular()">
            <div id="ajusteP2" style="font-size:12px;color:#d32f2f;margin-top:4px;"></div>
        </div>

        <div class="metric">
            <div class="metric-label">Custo Total P2</div>
            <div class="metric-value" id="custoP2">R$ 0</div>
        </div>

        <div class="metric">
            <div class="metric-label">Custo por Lote</div>
            <input type="number" id="custoLoteP2" class="input-field" value="50" onchange="calcular()">
        </div>

        <div class="metric">
            <div class="metric-label">Demanda</div>
            <input type="number" id="demandaP2" class="input-field" value="40" onchange="calcular()">
        </div>

        <div class="metric">
            <div class="metric-label">Status</div>
            <div class="metric-value" id="statusP2">—</div>
        </div>
    </div>

</div>

<div class="grid-2">

    <div class="maquina-card">
        <h3>Misturador</h3>

        <div class="metric">
            <div class="metric-label">Capacidade (horas)</div>
            <input type="number" id="capMisturador" class="input-field" value="250" onchange="calcular()">
        </div>

        <div id="usoMisturador">0 / 250 horas</div>

        <div class="barra">
            <div id="barraMisturador" class="barra-fill">0%</div>
        </div>
    </div>

    <div class="maquina-card">
        <h3>Reator</h3>

        <div class="metric">
            <div class="metric-label">Capacidade (horas)</div>
            <input type="number" id="capReator" class="input-field" value="200" onchange="calcular()">
        </div>

        <div id="usoReator">0 / 200 horas</div>
        <div id="ajusteReator" style="font-size:12px;color:#d32f2f;margin-top:4px;"></div>

        <div class="barra">
            <div id="barraReator" class="barra-fill azul">0%</div>
        </div>
    </div>

</div>

<div class="card">
    <div class="card-header">Tempos de Processamento (h/lote)</div>

    <table>
        <thead>
            <tr>
                <th>Máquina</th>
                <th>P1</th>
                <th>P2</th>
            </tr>
        </thead>

        <tr>
            <td>Misturador</td>
            <td><input class="input-cell" id="tempoMistP1" value="2" step="0.1" onchange="calcular()"></td>
            <td><input class="input-cell" id="tempoMistP2" value="3" step="0.1" onchange="calcular()"></td>
        </tr>

        <tr>
            <td>Reator</td>
            <td><input class="input-cell" id="tempoReatP1" value="2.5" step="0.1" onchange="calcular()"></td>
            <td><input class="input-cell" id="tempoReatP2" value="3" step="0.1" onchange="calcular()"></td>
        </tr>
    </table>
</div>

<script>
function calcular() {

    //-----------------------------
    // Entradas
    //-----------------------------
    let P1 = +lotesP1.value || 0;
    let P2_input = +lotesP2.value || 0;
    let P2 = P2_input; // pode ser ajustado

    const c1 = +custoLoteP1.value || 0;
    const c2 = +custoLoteP2.value || 0;

    const d1 = +demandaP1.value || 0;
    const d2 = +demandaP2.value || 0;

    const tm1 = +tempoMistP1.value;
    const tm2 = +tempoMistP2.value;
    const tr1 = +tempoReatP1.value;
    const tr2 = +tempoReatP2.value;

    const capMist = +capMisturador.value;
    const capReat = +capReator.value;

    //-----------------------------
    // Consumo inicial
    //-----------------------------
    const usoReatorBase = P1 * tr1 + P2 * tr2;

    // Mostra quanto seria antes
    if (usoReatorBase > capReat) {
        ajusteReator.textContent = `Antes: ${usoReatorBase.toFixed(1)}h → ajustado para caber`;
    } else {
        ajusteReator.textContent = "";
    }

    //-----------------------------
    // Ajuste automático como AMPL
    //-----------------------------
    if (usoReatorBase > capReat) {

        let maxP2 = (capReat - P1 * tr1) / tr2;
        if (maxP2 < 0) maxP2 = 0;

        let P2_new = Math.floor(maxP2);

        if (P2_new !== P2_input) {
            ajusteP2.textContent = `Ajustado automaticamente: era ${P2_input}, agora ${P2_new}`;
        } else {
            ajusteP2.textContent = "";
        }

        P2 = P2_new;
        lotesP2.value = P2;
    } else {
        ajusteP2.textContent = "";
    }

    //-----------------------------
    // Uso final das máquinas
    //-----------------------------
    const usoMist = P1 * tm1 + P2 * tm2;
    const usoReat = P1 * tr1 + P2 * tr2;

    usoMisturador.textContent = `${usoMist.toFixed(1)} / ${capMist} horas`;
    usoReator.textContent = `${usoReat.toFixed(1)} / ${capReat} horas`;

    //-----------------------------
    // Penalidade (igual AMPL)
    //-----------------------------
    const d2_real = Math.max(0, d2 - P2);
    const penalidade = d2_real * 1000;

    penalidadeTotal.textContent = "R$ " + penalidade.toLocaleString("pt-BR");

    penalidadeDetalhes.textContent =
        d2_real === 0
        ? "Nenhuma penalidade"
        : `P2 faltou ${d2_real} unidades (R$ ${penalidade.toLocaleString("pt-BR")})`;

    //-----------------------------
    // Status da demanda
    //-----------------------------
    statusP1.textContent = P1 >= d1 ? "✓ Atende demanda" : "✗ Não atende demanda";
    statusP1.style.color = P1 >= d1 ? "#4CAF50" : "#f44336";

    statusP2.textContent = P2 >= d2 ? "✓ Atende demanda" : "✗ Não atende demanda";
    statusP2.style.color = P2 >= d2 ? "#4CAF50" : "#f44336";

    //-----------------------------
    // Barras de máquina
    //-----------------------------
    const percMist = usoMist / capMist * 100;
    barraMisturador.style.width = Math.min(percMist, 100) + "%";
    barraMisturador.style.background = "#2E7D32";
    barraMisturador.textContent = percMist.toFixed(1) + "%";

    const percReat = usoReat / capReat * 100;
    barraReator.style.width = Math.min(percReat, 100) + "%";
    barraReator.style.background = "#1976D2";
    barraReator.textContent = percReat.toFixed(1) + "%";

    //-----------------------------
    // Status final
    //-----------------------------
    statusSolucao.textContent = "✔ Viável";
    statusSolucao.style.color = "#2E7D32";
    statusDetalhes.textContent = "Nenhuma restrição violada";

    //-----------------------------
    // Totais
    //-----------------------------
    totalLotes.textContent = P1 + P2;
    descLotes.textContent = `${P1} + ${P2} lotes`;

    const custoTotalCalc = P1*c1 + P2*c2 + penalidade;
    custoTotal.textContent = "R$ " + custoTotalCalc.toLocaleString("pt-BR");
}

window.onload = calcular;
</script>

</body>
</html>
